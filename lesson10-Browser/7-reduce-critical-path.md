# Сокращение критического пути
Критический путь - это минимальный набор действий, которые браузеру необходимо совершить для того, чтобы пользователь мог начать работать со страницей. Обычно это включает в себя:
- Загрузку ресурсов (HTML, CSS, JavaScript, картинки)
- Парсинг и обработку ресурсов (например, построение DOM-дерева или исполнение скриптов)
- Отрисовку получившейся страницы

Каждый из этих пунктов можно разбить на множество подпунктов, но основная идея заключается в том, что для ускорения работы страницы нужно сокращать критический путь. Для этого существует множество разных способов и невозможно разобрать их все, поэтому мы разберём только самые распространённые.

> Всегда профилируйте до и после оптимизации. Без измерений вы не сможете понять помогают ли ваши правки, или делают только хуже.

## Уменьшайте количество блокирующих скриптов
Встретив тег `<script>` браузер останавливает парсинг HTML, загружает его (если скрипт внешний) и выполняет. Причём перед выполнением скрипта браузеру придётся построить DOM и CSSOM, потому что они могут понадобиться при выполнении.

В большинстве случаев, нам не нужно сразу менять разметку, которая пришла с сервера. Чтобы показать браузеру, что наши скрипты можно грузить отложенно, можно воспользоваться атрибутами `async` и `defer`, которые мы разбирали в статье ["Способы подключения скрипта"](../lesson5-JS/lesson5_02.md).

> Атрибут `async` является более предпочтительным, т.к. он позволяет параллельно загружать несколько скриптов и не блокирует событие `DOMContentLoaded`.

## Отдавайте подходящие размеры картинок
Мы уже немного разбирали оптимизацию изображений [раньше](5-asset-size-optimization.md), а именно уменьшение размера. Это неплохой подход, но можно сделать ещё лучше.

Пользователи смотрят сайты с абсолютно разных устройств. У них может быть дешёвый смартфон с плохим экраном, а может быть флагман с высоким разрешением и большой плотностью пикселей. Экраны разных ноутбуков и мониторы тоже сильно отличаются друг от друга.

Чтобы пользователи всех устройств получали максимально чёткую картинку, но при этом не тратили лишний трафик, нам нужно иметь несколько размеров изображений. Для этого у тега `<img>` есть атрибуты [`srcset`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#attr-srcset) и [`sizes`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#attr-sizes).

```html
<img src="flower-large.jpg" srcset="flower-small.jpg 480w, flower-large.jpg 1080w" sizes="50vw">
```

Эти атрибуты позволяют использовать разную картинку в зависимости от размеров экрана. В примере выше написано следующее:

- При ширине экрана до 1080px - используй картинку flower-small.jpg
- При ширине экрана 1080px и больше - используй картинку flower-large.jpg
- В любом случае, картинка должна занимать половину ширины экрана.

> Атрибут `src` указывается для старых браузеров, которые не поддерживают `srcset` и `sizes`. В нём должна быть указана картинка, которая подходит большинству пользователей.

### Дополнительные материалы
[Профилирование критического пути](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/measure-crp?hl=en)
[Устройство отзывчивых картинок](https://jakearchibald.com/2015/anatomy-of-responsive-images/)