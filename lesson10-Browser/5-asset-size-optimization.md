# Оптимизация по объему содержимого

Как тратить меньше времени на загрузку данных? Все просто — будем грузить меньше! Для каждого типа 
содержимого, загружаемого браузером есть различные техники, позволяющие снизить объемы загружаемых данных

## Минификация исходного кода

Когда мы пишем исходный код нашего сайта (речь про HTML, CSS и JavaScript-код), мы используем понятные названия 
переменных и функций (а не "a" и "b"), используем переводы строк и табуляцию для форматирования кода,
что бы он был читабельным и аккуратным, пишем комментарии. Все это нужно программисту, но не нужно браузеру. 
Ему совершенно безразлично есть ли комментарии и насколько осмысленны имена переменных. 
Отсутствие всего этого позволяет сделать код гораздо компактнее чем его пишет программист. Сравните например:

```javascript
    /**
     * Выполняет сортировку пузырьком.
     * Клонирует массив, сортирует его и возвращает
     * @param {Array} data массив для сортировки.
     * @returns {Array} Новый отсортированный массив
     */
    function bubbleSort(data) {
        let hasChanges;
        let result = [...data];
        do {
            hasChanges = false;
            for (let i = 0; i < result.length - 1; i++) {
                const [a, b] = [result[i], result[i + 1]];
                if (a > b) {
                    [result[i], result[i + 1]] = [b, a];
                    hasChanges = true;
                }
            }
        } while (hasChanges);
        return result;
    }
```
  
А вот то же самое, но если сократить или удалить все избыточное:

```javascript
function bubbleSort(t){let e,l=[...t];do{
e=!1;for(let t=0;t<l.length-1;t++){const[n,o]=[l[t],l[t+1]];
n>o&&([l[t],l[t+1]]=[o,n],e=!0)}}while(e);return l}
```
  
Выигрыш 76%! Результат занимает всего лишь треть от исходного!

Аналогичную процедуру можно выполнить для CSS-стилей и для HTML-кода страницы. 
В случае HTML-кода, как правило, убираются незначащие переводы строк. Для CSS возможны более интересные модификации.

Например, можно применить следующие модификации. Вариант до изменений:
```css
.some_selector {
    margin: 0px;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 20px;
    padding-bottom: 20px;
}
```

Вариант после сжатия:
```css
.some_selector{margin:0;padding:20px 10px}
```

Для оптимизации CSS есть замечательная утилита [CSSO](https://css.github.io/csso/csso.html) 

К счастью не надо делать это руками. Есть специальные утилиты — минификаторы. 
Обычно минификацию применяют на этапе подготовки кода сайта к выкладке на production-окружение. 
В идеале она проводится автоматически без участия разработчика с помощью скриптов.

## Минификация изображений

Различные изображения, используемые для оформления страниц сайта, также поддаются сжатию. 
Большинство изображений в Web уже передаются в форматах, подразумевающих сжатие (например JPEG, PNG) 
но даже не меняя формат только корректировкой параметров сжатия можно существенно уменьшить размер файла 
без потери качества (видимых пользователю).

Давайте на примере рассмотрим как выглядит одно и тоже фото, сохраненное с разным качеством в разных форматах

За оригинал возьмем вот этого черного пёселя (в несжатом виде занимает 224 Кб)

![Оригинал](./images/dog-100.jpg)

Сохраним его в JPEG со сжатием 50%. С первого взгляда различия почти не заметны, 
а размер файла похудел в 22 раза до 10 Кб

![JPEG, 50%](./images/dog-50.jpg)

Можно продолжить: качество 25%, размер 6 Кб. Искажения уже заметны и бросаются в глаза. 
Пожалуй, эти 4 Кб не стоят того...

![JPEG, 25%](./images/dog-25.jpg)

Для современных браузеров существует новый формат, оптимизированный для Web - WebP. 
Этот формат дает более "приятную" картинку по сравнению с JPEG при аналогичном размере файла. Ниже первое изображение
сжато JPEG с качеством 50% и занимает 10Kb, второе изображение сжато WebP с качеством 81% и занимает тот же объем.

![JPEG, 50%, 10Kb](./images/dog-50.jpg)
![WebP, 81%, 10Kb](./images/dog-81.webp)

Еще одно направление для оптимизации изображений — метаинформация. Изображение может содержать дополнительные 
данные, не относящиеся к визуальному представлению. Например, место съемки, параметры экспозиции, 
объектив, модель камеры и т.п. Все это не видно глазу пользователя, но загружается по каналам связи. 
Метаинформацию можно безболезненно вырезать уменьшая тем самым объем файла. Например, у пёселя из примера выше 
в исходном файле метаинформация занимала до 1 Кб.

Сжатие изображений, так же как и минификацию кода, можно автоматизировать. 
Для этого можно использовать, например, утилиту [imagemin](https://web.dev/use-imagemin-to-compress-images/)

## Сжатие на уровне передачи данных

Еще один способ уменьшить объем передаваемой информации — использовать сжатие на уровне протокола передачи данных.
Протокол HTTP, благодаря которому передаются все данные для наших страниц, позволяет уменьшать объем данных
используя алгоритмы сжатия, такие как GZip или Brotli.

Веб-сервер, обслуживающий запросы пользователя, сжимает передаваемый контент и сообщает об этом браузеру используя HTTP-заголовок
Content-encoding. В качестве значения заголовка передается алгоритм, которым выполнено сжатие.

```
Content-encoding: gzip
```

Сжатие на уровне передачи данных настраивается на стороне веб-сервера.