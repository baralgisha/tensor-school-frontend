# Работа с DOM

## Окружение

В данном уроке мы рассмотрим, как JavaScript может работать с html-документом.
Сам по себе JavaScript, как язык, не предусматривает никаких методов для работы с браузером и вообще не знает об html.
Как же тогда встроенный в браузер JavaScript взаимодействует с html-документом?
Для языка JavaScript браузер предоставляет свое окружение. Давайте взглянем на блок-схему:

![Window](windowObjects.svg)

Схема показывает, что доступно для JavaScript'a в браузерном окружении. Прежде всего - это глобальный объект Window, который включает в себя такие понятия как DOM, BOM, а также интерпретатор JavaScript. Именно глобальный объект Window, к которому у JavaScript'а есть доступ, позволяет нам работать с окном браузера, а следовательно и с html-документом.

## BOM

BOM - Browser Object Model. Это дополнительные (дочерние для Window) объекты, предоставляемые браузером(окружением) для работы с чем угодно, кроме документа. Не существует каких-либо официальных стандартов для BOM. Чтобы стандартизировать эти фундаментальные аспекты JavaScript, консорциум W3C определил основные BOM-элементы в спецификации HTML5 - https://html.spec.whatwg.org/.

BOM-объекты обеспечивают доступ к функционалу браузера. Например: 
* Объект **navigator** - для работы с версией браузера.
* Объект **location** - для работы с адресами.
* Объект **screen** - информация об экране пользователя.
* Функции **alert/confirm/prompt** - методы объекта окна браузера для коммуникации с пользователем, выводят диалоговые окна.
* ...

## DOM

DOM - Document Object Model. Представляет собой все содержимое html-документа в виде дерева объектов, с которыми можно взаимодействовать. Мы уже знаем, что основой любого html-документа являются теги и в соответствии с DOM каждый тег является объектом. Текст а также комментарии также являются объектами. Все эти объекты доступны при помощи JavaScript, мы можем использовать их для изменения страницы.

Познакомиться со структурой DOM, начнем с простого html-документа:
```html
<html>
    <head>
      <title>html-документ</title>
    </head>
    <body>
        <h1>Привет</h1>
        <p>Текст...</p>
        <!-- комментарий -->
        <p>Полный абзац</p>
    </body>
</html>
```

Все что написано в html-документе: каждый тег, текст, комментарий является частью DOM, их также называют узлами. Существует 12 типов узлов, о них можно узнать в спецификации DOM - https://dom.spec.whatwg.org/

## Типы узлов

На практике чаще всего используется 4 типа узлов:

* **document** – «входная точка» в DOM, все операции с DOM начинаются с этого объекта.
* **узлы-элементы** – HTML-теги, основные строительные блоки.
* **текстовые узлы** – содержат текст.
* **узлы-комментарии** – иногда в них можно включить информацию, которая не будет показана, но доступна в DOM.

## Навигация

Самые верхние узлы DOM-дерева доступны через JavaScript как свойства объекта document:

```js
document.documentElement; // DOM-узел, соответствует тегу html
document.head; // DOM-узел, соответствует тегу head
document.body; // DOM-узел, соответствует тегу body
```

Рассмотрим подробнее навигацию между узлами DOM-дерева. Узлы в дереве имеют иерархические отношения друг с другом. Термины "родитель", "потомок" и "брат или сестра" используются для описания отношений. 
На рисунке ниже изображены основные методы навигации:

![Window](domLinks.svg)

Как видно, можно использовать следующие свойства для перехода между узлами с помощью JavaScript:

* **parentNode** - объект, возвращает родителя.
* **childNodes** - коллекция, возвращает список всех детей, включая текстовые узлы. Коллекция – особый перебираемый объект-псевдомассив.
* **firstChild** - объект, возвращает первый дочерний узел.
* **lastChild** - объект, возвращает последний дочерний узел.
* **previousSibling** - объект, возвращает предыдущий узел того же родителя (предыдущий сосед).
* **nextSibling** - объект, возвращает следующий узел того же родителя (следующий сосед).

Навигационные свойства, описанные выше, относятся ко всем узлам в документе. В частности, в childNodes находятся и текстовые узлы и узлы-элементы и узлы-комментарии, если они есть. Но чаще всего требуется оперировать только узлами-элементами, т.е. тегами. Поэтому для навигации только между узлами-элементами по аналогии используются следующие свойства: 

* **parentElement**
* **children**
* **firstElementChild**
* **lastElementChild**
* **previousElementSibling**
* **nextElementSibling**

## Поиск узлов

Свойства навигации по DOM-дереву удобны, когда мы хотим получить объект, который находится рядом. В остальных случаях для получения произвольного элемента(ов) на странице существует несколько основных способов:


### querySelector
```js
elem.querySelector('ul > li');
```
Возвращает первый элемент, соответствующий данному CSS-селектору.


### querySelectorAll
```js
elem.querySelectorAll('ul > li');
```
Возвращает все элементы внутри elem, удовлетворяющие данному CSS-селектору.


### getElementById
```js
document.getElementById('elem');
```
Возвращает один элемент с указанным id или null, можно вызвать только для объекта document.


### getElementsByName
```js
document.getElementsByName('attrName');
```
Возвращает элементы с заданным значением атрибута name.


### getElementsByTagName
```js
elem.getElementsByTagName('div');
```
Возвращает элементы с данным тегом и возвращает их коллекцию. Передав "*" вместо тега, можно получить всех потомков.


### getElementsByClassName
```js
elem.getElementsByClassName('className');
```
Возвращает элементы, которые имеют данный CSS-класс.


### closest
```js
elem.closest('.parent');
```
Ищет ближайшего предка, который соответствует CSS-селектору


### matches
```js
elem.matches('.active');
```
Проверяет, удовлетворяет ли elem CSS-селектору, и возвращает true или false.


##  Атрибуты и свойства

Как известно у html-тегов могут быть заданы различные атрибуты, а DOM-элементы могут быть наделены различными свойствами. При загрузке страницы браузер "считывает" HTML-теги и атрибуты и генерирует из них DOM-объекты и свойства.

Так же как и для обычных объектов JavaScript мы можем создавать и удалять для DOM-обЪектов свойства и методы:
```js
document.body.helloWorld = 'Hello World'; // создали новое свойство для body

document.body.sayHelloWorld = () => { alert('Hello World'); }; // создали новый метод для body
```

Как было сказано ранее, браузер создает из атрибутов DOM-свойства. Таким образом, когда у элемента есть id или другой стандартный атрибут, создается соответствующее свойство. Но этого не происходит, если атрибут нестандартный. Стоит отметить, что стандартный атрибут для одного тега может быть нестандартным для другого.

Таким образом, для нестандартных атрибутов не будет соответствующих DOM-свойств, но способ получить значения атрибутов всё равно есть! Вот они:

* **elem.hasAttribute(name)** – проверяет наличие атрибута.
* **elem.getAttribute(name)** – получает значение атрибута..
* **elem.setAttribute(name, value)**  – устанавливает значение атрибута.
* **elem.removeAttribute(name)** – удаляет атрибут.

##  Добавление и удаление узлов

В разработке...

Рассказать:
- Изменение DOM innerHTML/outerHTML/textContent/data
- Создание DOM элементов и узлов createElement, createTextNode
- Методы вставки в DOM append/prepend/before/after
- Вставка в DOM insertAdjacentHTML/Text/Element
- Клонирование элемента cloneNode
- Удаление элемента remove
